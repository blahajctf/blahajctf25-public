import sys
from Crypto.Util.number import getPrime, bytes_to_long

def main(): 
    e = 65537

    target_msg = b"winner"
    target_int = bytes_to_long(target_msg)

    p = getPrime(1024)
    q = getPrime(1024)
    n = p * q

    print("="*60)
    print(f"\nBLAHAJ LICENSE AUTHENTICATION SERVICE")
    print(f"PROTOCOL: RAW RSA (No Padding)")
    print(f"\nn = {n}")
    print(f"e = {e}\n")
    print("="*60)

    try:
        print("""
@ @@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@ @   @@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @
@@@@@@   @@@@*     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@   @@@@@    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@ @@@@ @  @@@@@@    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@ @@@@ @   @*@@@  . @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@  @@@@ @   @@@@@   .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.
@@@  @@@@.@     ..@    .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#=  
@@@@ .@@@@ @ ..@@%@@@    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@- .   
@@@@@  @@@@  @ @@ @*@@@   @@@@@@@@@@@@@@@@@@@@@@@@@%         
@@@@@=.@@@@@  + @@@@ *@    @@@@@@@@@@@@@@@@@@@@@%:      . .  
@@@@@@    @@@    @@@@@ @    @@@@@@@@@@@@@@@@@@   .           
 *@@@@@@@   @@ @  @@@@@@@    @@@@@@@@@@@@@@-                 
@ @@@ @@@ :  @@    @@@@@@@   @@@@@@@@@@@+            .  . .  
@@@@@@@@@ @   @@  . @@@@@@@@ @@@@@@@@@.              .   .-  
@@@@@@@@@% =@  @@ @  @@@@@@@* @@@@@*         .         - *   
@@@@@@@@@@@ .@@ @  @.@@@@@@@ .@@@:             .      --     
@ @@@@@@@@@   @@ @  @@@@@@@@@ @-  .                 =. .: -: 
@@@@@@@@@@-@%@@ @ @  @@@@@@@@@     ..            -+:.: :-==: 
@@@@@@@@@@@@@ @     @ @@@@-   @                 :.:. : +=-+#=
@@@@@@@@@@@@@ @@@@   @ @:  .    .            =+-: -=-+#@@%@*:
@@@@@@@@@@@@@@ @@@    @                   ++-+-=----@%%@@+-@#
@@@@ +@@@@@@@@@@@@@@ @       .          *-==-=.++*@@@%@@#*#@@
@@@@@  @@@@@@@@@=@@@@                *+=#*--%+**@%@@@@+++%*@#
@@@@@@.@@@@@@@@# @@@@@          =.*+:*%=::-*@%@@@@@%##%%@@@@%
@@@@@@@@@@@@@@ .  @@@@:        =@ @@==+:#@@%@@@@@%@@%@@@@%@@%
@@@@@@@@@@@@        @@@   %# =%+@:+=.+@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@       .   @@@   @#-::.%.@%+%@@%@@@@@@@@@@@@@@@@@@ 
@@@@@@@@-         .  @@@@  .@@=-*@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@+      .     . .@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@%%  
@@@@@        .   . ::@ @@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@@#@@ 
@@@                @#@= @@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@=  .        : :.*@%@@@@@ @@@ @@@@@@@@@%-  -: @@@@@@@@@= @**:
           .:: #%@@@@@@+   %@@ @@@ @  .@+-@@@*   +@@@  @  @@ 
 .       :=.++@@*       .: **@@     :@ @@:** @@@@@@@  @@+@@@@
       .*#.@  = @.@@*@@%:@@: @@@ @:-@@@@@@%@%+#  -. #%@@%@@@@
.     * .     @*@ +        @. @@  @ @@@#@@@% - %#=@=@+@@@@@@@
    -.:.-. .%. -%@ + @- *@ %== @@ @@@@@@@% :+@@+@@:@@@@@@@@@@
  :%  =..=.# #@@.+@%@-@@@:   % @@@   @ @@  @+@@@@@:@@@@@@@@@@
 -  : @ -*+# @  +:#@ @@   -%   @  @@  .  #@+=@%@*@@@@@@@@@@@@
    .@%+#@@@@ @*.@  - @@@@@+#@@         %++:@*@@%@@%@@@@@@@@@
  .@%  @%-%    @  - .@@@   @@@@@        @@@@@#@@@@@@@@@@@@@@@
 @+*@@=@.  @@ = =   @   @@@@@@@@@@      @@@@%@@@@@@@@@@@@@@@@
- =# %@.@@@  .@   + + @@@@@@@@@@@@@      @@@@%@@@@@@@@@@@@@@@
 #  %@- @   @@  @  %.@@@@@@@@@@@@@@@#     @@@@@@@@@@@@@@@@@@@
  %@: %@      -  %#*@@@@@@@@@@@@%*@@@@    +@@%@@@@@@@@@@@@@@@
%@@ @@@      . =@* @@@@@@@@@@@@@@@@@@@@    @@@@@@@@@@@@@@@@@@
=  @@# @   # @@@@#- @@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@@@@@
 @@@      *@@: ==.@@@@@@@@@@@@@@@@@@@@@@: .  @@@@@@@@@@@@@@@@
 @@=    @@@-.-+@#@@@@@@@@@@@@@@@@@@@@@@@@  .  @@@@@@@@@@@@@@@
       @@.+@@+*+*@%@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@@
   @ @@- +.%:-@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@@@@
 @@ #@===#*=+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.    @@@@@@@@@@@@
 - :#:#+*#+=@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    @@@@@@@@@@@@
 = -*%-.@% #@#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  . .@@@@@@@@@@
 :*=+#=#+%*@+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    @@@@@@@@@@
 %=#-%+*++@@@#:@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    @@@@@@@@@
 *:-:@*%%@% @@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    @@@@@@@@
    :::=+-*@*@@*@#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    @@@@@@@
        """)
        
        cosmic_ray = int(input(f"\nYou charge up the Low Orbit Ion Cannon... > "))
        if not (0 <= cosmic_ray < 2048):
            raise ValueError("Too ambitious.")
    except (ValueError, TypeError):
        sys.exit(1)

    sig_hex = input("Enter the signature (in hex): > ").strip()
    
    try:
        sig_int = int(sig_hex, 16)
        
        n_corrupted = n ^ (1 << cosmic_ray) # I FIRE MY LAZERR!!!
        decrypted_int = pow(sig_int, e, n_corrupted)
        
        if decrypted_int == target_int:
            print("\n[+] Signature is VALID!")
            print("[*] License approved. Here is your flag:")
            with open("flag.txt", "r") as f:
                flag = f.read().strip()
                print(f"\n{flag}\n")
        else:
            print("\n[-] Signature is INVALID.")
            print(f"    Expected: {target_int}")
            print(f"    Got:      {decrypted_int}\n")

    except ValueError:
        print("\n[-] Invalid input format.\n")
    except Exception as err:
        print(f"\n[!] An unexpected error occurred: {err}\n")

if __name__ == "__main__":
    main()